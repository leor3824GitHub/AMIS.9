@page "/catalog/inspectionrequests"
<PageHeader Title="Inspection Requests" Header="Inspection Requests" SubHeader="Manage inspection requests for purchases." />

<MudDataGrid ServerData="ServerReload"
             MultiSelection="true"
             @bind-SelectedItems="_selectedItems"
             @bind-SelectedItem="_currentDto"
             ColumnResizeMode="ResizeMode.Column"
             Hover="true"
             Loading="@_loading"
             @ref="_table"
             Outlined>

    <ToolBarContent>
        <div class="d-flex align-center justify-between w-100 gap-2 flex-nowrap">
            <div class="d-flex align-center gap-1">
                <MudButton Variant="Variant.Filled"
                           Color="Color.Secondary"
                           Disabled="@_loading"
                           OnClick="@OnRefresh"
                           StartIcon="@Icons.Material.Filled.Refresh">Refresh</MudButton>

                @if (_canCreate)
                {
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Primary"
                               Disabled="@_loading"
                               OnClick="OnCreate"
                               StartIcon="@Icons.Material.Filled.Add">New</MudButton>
                }

                @if (_canDelete)
                {
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Error"
                               Disabled="@(_selectedItems.Count == 0)"
                               OnClick="OnDeleteChecked"
                               StartIcon="@Icons.Material.Filled.Delete">Delete</MudButton>
                }
            </div>
            <MudSpacer />
            @if (_canSearch)
            {
                <MudTextField T="string"
                              ValueChanged="@(s => OnSearch(s))"
                              Placeholder="Search"
                              Adornment="Adornment.Start"
                              AdornmentIcon="@Icons.Material.Filled.Search"
                              Class="mt-0 mb-3" />
            }
        </div>
    </ToolBarContent>

        <Columns>
            <SelectColumn T="InspectionRequestResponse" />
            @* <PropertyColumn Property="x => x.Purchase.PurchaseDate" Title="DatePurchase" /> *@
            <TemplateColumn Title="DatePurchase">
                <CellTemplate>
                    @(context.Item.Purchase.PurchaseDate.HasValue
                                    ? context.Item.Purchase.PurchaseDate.Value.ToString("yyyy-MM-dd")
                                    : "")
                </CellTemplate>
            </TemplateColumn>
            <PropertyColumn Property="x => x.Purchase.Supplier.Name" Title="Supplier Name" />
            <TemplateColumn Title="No. of Item/s" Style="width: 120px;" >
                    <CellTemplate>
                        @(context.Item.Purchase?.Items?.Count ?? 0)
                    </CellTemplate>
                </TemplateColumn>
        <PropertyColumn Property="x => x.Status" Title="Status" Style="width: 120px;" />
            <PropertyColumn Property="x => x.Inspector.Name" Title="Inspector" />
            @* <PropertyColumn Property="x => x.DateCreated" Title="Request Date" /> *@
            <TemplateColumn Title="Request Date">
                <CellTemplate>
                    @context.Item.DateCreated.ToString("yyyy-MM-dd")
                </CellTemplate>
            </TemplateColumn>
            <TemplateColumn Title="Action">
                <CellTemplate>
                    <MudMenu Icon="@Icons.Material.Filled.Edit" Dense="true">
                        @if (context.Item.InspectorId == null)
                        {
                            <MudMenuItem OnClick="@(() => OnAssign(context.Item))">Assign</MudMenuItem>
                        }
                        else
                        {
                            <MudMenuItem OnClick="@(() => ReAssign(context.Item))">Re-Assign</MudMenuItem>
                        }
                        <MudMenuItem OnClick="@(() => OnView(context.Item))">View</MudMenuItem>
                        <MudMenuItem OnClick="@(() => OnInspect(context.Item))">Inspect</MudMenuItem>
                    </MudMenu>
                </CellTemplate>
            </TemplateColumn>
        </Columns>

    <PagerContent>
        <MudDataGridPager />
    </PagerContent>
</MudDataGrid>
