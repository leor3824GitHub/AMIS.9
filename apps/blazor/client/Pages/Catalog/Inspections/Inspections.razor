@page "/catalog/inspections"
<PageHeader Title="Inspections" Header="Inspections" SubHeader="Manage inspections" />

<MudDataGrid ServerData="ServerReload"
             MultiSelection="true"
             @bind-SelectedItems="_selectedItems"
             @bind-SelectedItem="_currentDto"
             ColumnResizeMode="ResizeMode.Column"
             Hover="true"
             Loading="@_loading"
             @ref="_table"
             Outlined>

    <ToolBarContent>
        <div class="d-flex align-center justify-between w-100 gap-2 flex-nowrap">
            <div class="d-flex align-center gap-1">
                <MudButton Variant="Variant.Filled"
                           Color="Color.Secondary"
                           Disabled="@_loading"
                           OnClick="@OnRefresh"
                           StartIcon="@Icons.Material.Filled.Refresh">Refresh</MudButton>

                @if (_canCreate)
                {
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Primary"
                               Disabled="@_loading"
                               OnClick="OnCreate"
                               StartIcon="@Icons.Material.Filled.Add">New</MudButton>
                }

                @if (_canDelete)
                {
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Error"
                               Disabled="@(_selectedItems.Count == 0)"
                               OnClick="OnDeleteChecked"
                               StartIcon="@Icons.Material.Filled.Delete">Delete</MudButton>
                }
            </div>
            <MudSpacer />
            @if (_canSearch)
            {
                <MudTextField T="string"
                              ValueChanged="@(s => OnSearch(s))"
                              Placeholder="Search"
                              Adornment="Adornment.Start"
                              AdornmentIcon="@Icons.Material.Filled.Search"
                              Class="mt-0 mb-3" />
            }
        </div>
    </ToolBarContent>

        <Columns>
            <SelectColumn T="InspectionResponse" />
            <PropertyColumn Property="x => x.InspectedOn" Title="Inspection Date" />
            <TemplateColumn Title="Inspector">
                <CellTemplate>
                    @(context.Item?.Employee?.Name ?? "—")
                </CellTemplate>
            </TemplateColumn>
            <TemplateColumn Title="Supplier Name">
                <CellTemplate>
                    @(context.Item?.Purchase?.Supplier?.Name ?? "—")
                </CellTemplate>
            </TemplateColumn>
            <TemplateColumn Title="Status">
                <CellTemplate>
                    @if (context.Item is not null)
                    {
                        <MudChip Color="@GetStatusColor(context.Item)" Size="Size.Small" Variant="Variant.Text">
                            @context.Item.Status
                        </MudChip>
                    }
                    else
                    {
                        <MudText>—</MudText>
                    }
                </CellTemplate>
            </TemplateColumn>
            <TemplateColumn Title="Remarks">
                <CellTemplate>
                    @(context.Item?.Remarks ?? "")
                </CellTemplate>
            </TemplateColumn>
            <TemplateColumn Title="Action">
                <CellTemplate>
                    <MudMenu Icon="@Icons.Material.Filled.Edit" Dense="true">
                        <MudMenuItem Disabled="@(!CanEdit(context.Item))" OnClick="@(() => OnEdit(context.Item))">Edit</MudMenuItem>
                        <MudMenuItem Disabled="@(!CanDelete(context.Item))" OnClick="@(() => OnDelete(context.Item))">Delete</MudMenuItem>
                        @if (_canUpdate)
                        {
                            <MudMenuItem Disabled="@(!IsApproveEnabled(context.Item))" OnClick="@(() => OnApprove(context.Item))">Approve</MudMenuItem>
                        }
                    </MudMenu>
                </CellTemplate>
            </TemplateColumn>
        </Columns>

    <PagerContent>
        <MudDataGridPager />
    </PagerContent>
</MudDataGrid>
