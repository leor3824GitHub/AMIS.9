<EditForm Model="@Model" OnValidSubmit="OnValidSubmit">
    <MudDialog>
        <DialogContent>
            <DataAnnotationsValidator />
            <ValidationSummary />

            <!-- Purchase Information Section -->
            <MudPaper Class="pa-2 mb-2" Elevation="1" Square="true">
                <MudGrid>
                    <MudItem xs="12" sm="6" md="3">
                        <MudSelect T="Guid?" Label="Supplier" @bind-Value="Model.SupplierId">
                            @foreach (var suppliers in _suppliers)
                            {
                                <MudSelectItem T="Guid?" Value="suppliers.Id">@suppliers.Name</MudSelectItem>
                            }
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="12" sm="6" md="3">
                        <MudDatePicker @bind-Date="Model.PurchaseDate" Label="Purchase Date" For="@(() => Model.PurchaseDate)" />
                    </MudItem>
                    <MudItem xs="12" sm="6" md="3">
                        <MudSelect T="PurchaseStatus?" Label="Status" @bind-Value="Model.Status">                        
                            @foreach (var status in PurchaseStatusList)
                            {
                                <MudSelectItem T="PurchaseStatus?" Value="status">@GetDisplayName(status)</MudSelectItem>
                            }
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="12" sm="6" md="3">
                        <MudTextField @bind-Value="Model.TotalAmount" Label="TotalAmount" For="@(() => Model.TotalAmount)" ReadOnly="true" />
                    </MudItem>                
                </MudGrid>
            </MudPaper>

            <!-- ✅ Move Save/Cancel Button Here -->
            <MudPaper Class="pa-2 mb-2" Elevation="0" Square="true">
                <MudStack Row Spacing="2">
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" ButtonType="ButtonType.Submit">Save</MudButton>
                    <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="Cancel">Cancel</MudButton>
                </MudStack>
            </MudPaper>
            @if (Model.Id != Guid.Empty)
            {
                <!-- ✅ Include PurchaseItemList inside the same DialogContent -->
                <PurchaseItemList Items="@Model.Items"
                                  Products="_products"
                                  Suppliers="_suppliers"
                                  Status="Model.Status"
                                  PurchaseId="@Model.Id"
                                  OnTotalAmountChanged="UpdateTotalAmount" />
            }
            else
            {
                <MudText Color="Color.Warning">Save the purchase first to manage items.</MudText>
            }
           
        </DialogContent>

    </MudDialog>
</EditForm>
